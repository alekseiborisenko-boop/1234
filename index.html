<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>II-Agent Pro v5.0 - Full Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            /* Cyberpunk Colors */
            --bg-primary: #0a0e14;
            --bg-secondary: #0f1419;
            --bg-tertiary: #1a1f2e;
            --bg-card: #151b26;
            
            --text-primary: #e4e4e7;
            --text-secondary: #94a3b8;
            --text-dim: #64748b;
            
            --accent-cyan: #00ffff;
            --accent-cyan-dark: #00cccc;
            --accent-purple: #a78bfa;
            --accent-pink: #f472b6;
            
            --neon-glow: 0 0 10px rgba(0, 255, 255, 0.5);
            --neon-glow-strong: 0 0 20px rgba(0, 255, 255, 0.8);
            
            --border: rgba(0, 255, 255, 0.2);
            --border-bright: rgba(0, 255, 255, 0.5);
            
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        @keyframes neonPulse {
            0%, 100% { box-shadow: var(--neon-glow); opacity: 1; }
            50% { box-shadow: var(--neon-glow-strong); opacity: 0.8; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background: 
                radial-gradient(ellipse at top, rgba(0, 255, 255, 0.05), transparent),
                radial-gradient(ellipse at bottom, rgba(167, 139, 250, 0.05), transparent),
                var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: var(--bg-secondary);
            padding: 16px 24px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 calc(100% - 8px));
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-left h1 {
            font-size: 20px;
            color: var(--accent-cyan);
            text-shadow: var(--neon-glow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--success);
            animation: neonPulse 2s infinite;
        }

        .header-right {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
            color: var(--text-primary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .header-btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
            box-shadow: var(--neon-glow-strong);
        }

        /* ==================== TABS ==================== */
        .tabs {
            background: var(--bg-secondary);
            display: flex;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border: none;
            border-right: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
        }

        .tab:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--bg-primary);
            color: var(--accent-cyan);
            box-shadow: inset 0 -3px 0 var(--accent-cyan);
        }

        .tab i {
            font-size: 16px;
        }

        /* ==================== TAB CONTENT ==================== */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== SCROLLBAR ==================== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-left: 1px solid var(--border);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 10px;
            box-shadow: var(--neon-glow);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--accent-purple), var(--accent-cyan));
        }
        /* ==================== COMMON COMPONENTS ==================== */
        .section-title {
            font-size: 18px;
            color: var(--accent-cyan);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: var(--neon-glow);
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 12px 100%, 0 calc(100% - 12px));
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--border-bright);
            box-shadow: var(--neon-glow);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--accent-cyan);
            text-shadow: var(--neon-glow);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-purple) 100%);
            border: none;
            padding: 12px 24px;
            clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
            color: var(--bg-primary);
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--neon-glow-strong);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error) 0%, #b91c1c 100%);
        }

        /* ==================== TAB 1: CHAT ==================== */
        #chatTab {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
            padding: 0;
        }

        #chatMessages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            animation: slideIn 0.3s;
            align-items: flex-start;
        }

        .message-user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border);
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: var(--neon-glow);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-user .avatar {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .bubble {
            max-width: 70%;
            padding: 14px 18px;
            border-radius: 12px;
            line-height: 1.6;
            border: 1px solid var(--border);
        }

        .message-user .bubble {
            background: linear-gradient(135deg, var(--accent-cyan) 0%, var(--accent-purple) 100%);
            color: var(--bg-primary);
            font-weight: 500;
            border: none;
        }

        .message-assistant .bubble {
            background: var(--bg-card);
            border-left: 3px solid var(--accent-cyan);
        }

        .chat-input-area {
            background: var(--bg-secondary);
            padding: 20px 24px;
            border-top: 2px solid var(--border);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        #chatInput {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 18px;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            max-height: 120px;
            font-family: inherit;
        }

        #chatInput:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: var(--neon-glow);
        }

        /* ==================== TAB 2: KNOWLEDGE BASE ==================== */
        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .search-box input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: var(--neon-glow);
        }

        .search-box select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 12px 16px;
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
        }

        .search-results {
            max-height: 500px;
            overflow-y: auto;
        }

        .result-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-cyan);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .result-item:hover {
            border-left-color: var(--accent-purple);
            box-shadow: var(--neon-glow);
            transform: translateX(5px);
        }

        .result-similarity {
            display: inline-block;
            background: var(--accent-cyan);
            color: var(--bg-primary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .result-text {
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 13px;
        }

        .result-meta {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* ==================== TAB 3: TRAINING ==================== */
        .training-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-group {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .control-group label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .control-group input[type="number"] {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .checkbox-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-cyan);
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-primary);
            font-size: 12px;
            font-weight: bold;
        }

        .training-log {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 12px;
        }

        .log-entry {
            padding: 6px;
            margin-bottom: 4px;
            border-left: 3px solid var(--accent-cyan);
            padding-left: 10px;
        }

        .log-entry.success { border-left-color: var(--success); }
        .log-entry.error { border-left-color: var(--error); }
        .log-entry.warning { border-left-color: var(--warning); }

        .topic-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .topic-tag {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .topic-tag .remove {
            cursor: pointer;
            color: var(--error);
            font-weight: bold;
        }

        .topic-tag .remove:hover {
            color: white;
        }
        /* ==================== TAB 4: BACKUPS ==================== */
        .backup-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .backup-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .backup-item:hover {
            border-color: var(--border-bright);
            box-shadow: var(--neon-glow);
        }

        .backup-info {
            flex: 1;
        }

        .backup-hash {
            font-family: 'Consolas', monospace;
            color: var(--accent-cyan);
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .backup-message {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 4px;
        }

        .backup-meta {
            display: flex;
            gap: 16px;
            font-size: 11px;
            color: var(--text-dim);
        }

        .backup-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
        }

        .icon-btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
        }

        .icon-btn.danger:hover {
            background: var(--error);
            border-color: var(--error);
        }

        /* ==================== TAB 5: ADMIN ==================== */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .admin-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .admin-section h3 {
            color: var(--accent-cyan);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-result {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--success);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            font-size: 13px;
        }

        .test-result.failed {
            border-left-color: var(--error);
        }

        .test-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .test-error {
            color: var(--error);
            font-size: 12px;
            font-family: 'Consolas', monospace;
        }

        .model-tier {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-cyan);
        }

        .model-tier.junior { border-left-color: #3b82f6; }
        .model-tier.middle { border-left-color: var(--accent-cyan); }
        .model-tier.senior { border-left-color: var(--accent-purple); }
        .model-tier.expert { border-left-color: var(--accent-pink); }

        .model-tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .model-name {
            font-weight: bold;
            font-size: 14px;
        }

        .model-badge {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .model-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            font-size: 12px;
        }

        .model-stat-item {
            text-align: center;
        }

        .model-stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent-cyan);
            display: block;
        }

        .model-stat-label {
            color: var(--text-dim);
            font-size: 10px;
            text-transform: uppercase;
        }

        .expert-requests {
            max-height: 400px;
            overflow-y: auto;
        }

        .expert-request-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-left: 4px solid var(--warning);
            padding: 14px;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .expert-request-item.answered {
            border-left-color: var(--success);
            opacity: 0.7;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .request-id {
            font-family: 'Consolas', monospace;
            color: var(--accent-cyan);
            font-size: 12px;
        }

        .request-priority {
            background: var(--warning);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .request-priority.high {
            background: var(--error);
        }

        .request-priority.low {
            background: var(--success);
        }

        .request-query {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .request-date {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 20px 100%, 0 calc(100% - 20px));
            animation: slideIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            color: var(--accent-cyan);
            text-shadow: var(--neon-glow);
        }

        .modal-close {
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--error);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: var(--neon-glow);
        }

        /* ==================== LOADING SPINNER ==================== */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .spinner-overlay.active {
            display: flex;
        }

        .spinner-large {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.2);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .admin-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }

            .header-left h1 {
                font-size: 16px;
            }

            .tabs {
                overflow-x: auto;
            }

            .tab {
                min-width: 100px;
                padding: 12px 16px;
                font-size: 12px;
            }

            .tab i {
                font-size: 14px;
            }

            .tab-content {
                padding: 16px;
            }

            .bubble {
                max-width: 85%;
            }

            .stat-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .tab span {
                display: none;
            }

            .tab {
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- AI DEVELOPER FIXED BUTTON -->
    <button id="ai-dev-btn-fixed" style="
        position: fixed;
        top: 70px;
        right: 20px;
        padding: 12px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        transition: transform 0.2s;
    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" onclick="
        if(document.getElementById('ai-dev-panel')) {
            document.getElementById('ai-dev-panel').style.display = 
                document.getElementById('ai-dev-panel').style.display === 'none' ? 'block' : 'none';
        } else {
            document.getElementById('ai-dev-panel').style.display='block'; return; alert('🤖 AI Developer API\n\nEndpoints:\n✅ POST /ai-dev/analyze\n✅ POST /ai-dev/generate\n✅ POST /ai-dev/backup\n✅ GET /ai-dev/backups\n✅ POST /ai-dev/rollback');
        }
    ">🤖 AI Developer</button>
    

    <div class="container">
        <!-- ==================== HEADER ==================== -->
        <header class="header">
            <div class="header-left">
                <h1>
                    <div class="status-indicator"></div>
                    🤖 II-AGENT PRO v5.0
                </h1>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="clearCurrentTab()">
                    <i class="fas fa-trash"></i> Очистить
                </button>
                <button class="header-btn" onclick="refreshData()">
                    <i class="fas fa-sync"></i> Обновить
                </button>
            </div>
        </header>

        <!-- ==================== TABS ==================== -->
        <div class="tabs">
            <button class="tab active" data-tab="chat">
                <i class="fas fa-comments"></i>
                <span>ЧАТ</span>
            </button>
            <button class="tab" data-tab="knowledge">
                <i class="fas fa-brain"></i>
                <span>БАЗА ЗНАНИЙ</span>
            </button>
            <button class="tab" data-tab="training">
                <i class="fas fa-moon"></i>
                <span>ОБУЧЕНИЕ</span>
            </button>
            <button class="tab" data-tab="backups">
                <i class="fas fa-save"></i>
                <span>БЭКАПЫ</span>
            </button>
            <button class="tab" data-tab="admin">
                <i class="fas fa-cog"></i>
                <span>АДМИНКА</span>
            </button>
        </div>

        <!-- ==================== TAB 1: CHAT ==================== -->
        <div class="tab-content active" id="chatTab">
            <div id="chatMessages"></div>

            <!-- Настройки чата -->
            <div style="padding: 12px; background: var(--bg-card); border-radius: 12px; margin: 15px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; border: 1px solid rgba(0, 255, 255, 0.1);">
                                <!-- PROVIDER SELECTOR -->
                <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 300px; border-left: 2px solid var(--accent-cyan); padding-left: 12px;">
                    <span style="color: var(--text-secondary); font-size: 14px; font-weight: bold;">?? AI:</span>
                    <button id="btn-ollama" onclick="selectedProvider='ollama'; updateProviderUI();" style="padding: 6px 12px; background: var(--accent-cyan); color: var(--bg-primary); border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold;">Ollama</button>
                    <button id="btn-groq" onclick="selectedProvider='groq'; updateProviderUI();" style="padding: 6px 12px; background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px;">Groq</button>
                    <button id="btn-gigachat" onclick="selectedProvider='gigachat'; updateProviderUI();" style="padding: 6px 12px; background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px;">GigaChat</button>
                    <span id="provider-status" style="margin-left: 8px; color: var(--accent-cyan); font-size: 12px; font-weight: bold;">LOCAL</span>
                </div>

<div style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="useWeb" style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-cyan);">
                    <label for="useWeb" style="cursor: pointer; color: var(--text-primary); font-size: 14px;">🌐 Веб-поиск</label>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="useRag" checked style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-cyan);">
                    <label for="useRag" style="cursor: pointer; color: var(--text-primary); font-size: 14px;">🧠 База знаний</label>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 250px;">
                    <label style="color: var(--text-secondary); font-size: 14px;">🤖 Модель:</label>
                    <select id="modelSelect" style="flex: 1; padding: 8px 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--accent-cyan); border-radius: 8px; cursor: pointer; font-size: 13px;">
                        <option value="qwen2.5:7b-instruct-q5_K_M">Qwen 2.5 7B Instruct</option>
                    </select>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <textarea id="chatInput" placeholder="Введите сообщение..." rows="1"></textarea>
                    <button class="btn" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane"></i> Отправить
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: KNOWLEDGE BASE ==================== -->
        <div class="tab-content" id="knowledgeTab">
            <h2 class="section-title">
                <i class="fas fa-brain"></i>
                База Знаний (RAG)
            </h2>

            <!-- Statistics -->
            <div class="stat-grid">
                <div class="stat-item">
                    <div class="stat-value" id="ragDialogues">0</div>
                    <div class="stat-label">Диалоги</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="ragTraining">0</div>
                    <div class="stat-label">Обучающие данные</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="ragSize">0 MB</div>
                    <div class="stat-label">Размер базы</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="ragUsage">0</div>
                    <div class="stat-label">Использований</div>
                </div>
            </div>

            <!-- Search -->
            <div class="card">
                <h3>🔍 Поиск в базе</h3>
                <div class="search-box">
                    <input type="text" id="ragSearchInput" placeholder="Введите запрос...">
                    <select id="ragCollection">
                        <option value="all">Все коллекции</option>
                        <option value="dialogues">Диалоги</option>
                        <option value="training">Обучающие данные</option>
                        <option value="code">Код</option>
                        <option value="solutions">Решения</option>
                    </select>
                    <button class="btn" onclick="searchRAG()">
                        <i class="fas fa-search"></i> Поиск
                    </button>
                </div>
                <div class="search-results" id="ragSearchResults"></div>
            </div>

            <!-- Add Manually -->
            <div class="card">
                <h3>➕ Добавить вручную</h3>
                <div class="form-group">
                    <label>Вопрос</label>
                    <textarea id="manualQuestion" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Ответ</label>
                    <textarea id="manualAnswer" rows="5"></textarea>
                </div>
                <button class="btn" onclick="addManualDialogue()">
                    <i class="fas fa-plus"></i> Добавить в базу
                </button>
            </div>
        </div>

        <!-- ==================== TAB 3: TRAINING ==================== -->
        <div class="tab-content" id="trainingTab">
            <h2 class="section-title">
                <i class="fas fa-moon"></i>
                Ночное Обучение
            </h2>

            <!-- Status -->
            <div class="card">
                <h3>📊 Текущий статус</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="trainingStatus">⏸️</div>
                        <div class="stat-label">Статус</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="trainingProgress">0/0</div>
                        <div class="stat-label">Прогресс</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="trainingAdded">0</div>
                        <div class="stat-label">Добавлено записей</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="trainingCurrent">-</div>
                        <div class="stat-label">Текущий цикл</div>
                    </div>
                </div>

                <div class="progress-bar" style="margin-top: 16px;">
                    <div class="progress-fill" id="trainingProgressBar" style="width: 0%;">0%</div>
                </div>
            </div>

            <!-- Settings -->
            <div class="card">
                <h3>⚙️ Настройки обучения</h3>
                <div class="training-controls">
                    <div class="control-group">
                        <label>Часов обучения</label>
                        <input type="number" id="trainingHours" value="8" min="1" max="24">
                    </div>
                    <div class="control-group">
                        <label>Циклов в час</label>
                        <input type="number" id="trainingCyclesPerHour" value="4" min="1" max="10">
                    </div>
                </div>

                <div class="control-group">
                    <label>Источники данных</label>
                    <div class="checkbox-list">
                        <label class="checkbox-item">
                            <input type="checkbox" id="sourceWikipedia" checked>
                            <span>📚 Wikipedia (общие знания)</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="sourceGithub" checked>
                            <span>💻 GitHub (код и примеры)</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="sourceHabr" checked>
                            <span>📰 Habr (русские IT статьи)</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="sourceStackOverflow">
                            <span>🔧 Stack Overflow (решения проблем)</span>
                        </label>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="btn" onclick="startTraining()">
                        <i class="fas fa-play"></i> Запустить
                    </button>
                    <button class="btn btn-danger" onclick="stopTraining()">
                        <i class="fas fa-stop"></i> Остановить
                    </button>
                </div>
            </div>

            <!-- Logs -->
            <div class="card">
                <h3>📜 Журнал обучения</h3>
                <div class="training-log" id="trainingLogs">
                    <div class="log-entry">Ожидание запуска...</div>
                </div>
            </div>

            <!-- Custom Topics -->
            <div class="card">
                <h3>🎯 Пользовательские темы</h3>
                <div class="form-group">
                    <input type="text" id="customTopic" placeholder="Добавить тему для парсинга (например: FastAPI REST API)">
                </div>
                <button class="btn btn-secondary" onclick="addCustomTopic()">
                    <i class="fas fa-plus"></i> Добавить тему
                </button>
                <div class="topic-list" id="customTopicList"></div>
            </div>
        </div>

        <!-- ==================== TAB 4: BACKUPS ==================== -->
        <div class="tab-content" id="backupsTab">
            <h2 class="section-title">
                <i class="fas fa-save"></i>
                Система Бэкапов (Git)
            </h2>

            <!-- Create Backup -->
            <div class="card">
                <h3>🆕 Создать бэкап</h3>
                <div class="form-group">
                    <label>Комментарий (необязательно)</label>
                    <input type="text" id="backupMessage" placeholder="Manual backup before update">
                </div>
                <button class="btn" onclick="createBackup()">
                    <i class="fas fa-save"></i> Создать бэкап сейчас
                </button>
            </div>

            <!-- Auto Backups Settings -->
            <div class="card">
                <h3>⚙️ Автоматические бэкапы</h3>
                <div class="checkbox-list">
                    <label class="checkbox-item">
                        <input type="checkbox" id="autoBackup6h" checked>
                        <span>Каждые 6 часов</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="autoBackupTraining" checked>
                        <span>После завершения обучения</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="autoBackupError" checked>
                        <span>При критических ошибках</span>
                    </label>
                </div>
            </div>

            <!-- Backup List -->
            <div class="card">
                <h3>📋 Список бэкапов</h3>
                <div class="backup-list" id="backupList">
                    <div style="text-align: center; color: var(--text-dim); padding: 40px;">
                        Загрузка бэкапов...
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== TAB 5: ADMIN ==================== -->
        <div class="tab-content" id="adminTab">
            <h2 class="section-title">
                <i class="fas fa-cog"></i>
                Панель Администратора
            </h2>

            <div class="admin-grid">
                <!-- Tests -->
                <div class="admin-section">
                    <h3><i class="fas fa-flask"></i> Тесты системы</h3>
                    <button class="btn" onclick="runTests()" style="width: 100%; margin-bottom: 16px;">
                        <i class="fas fa-play"></i> Запустить все тесты
                    </button>
                    <div id="testResults"></div>
                </div>

                <!-- Model Hierarchy -->
                <div class="admin-section">
                    <h3><i class="fas fa-layer-group"></i> Иерархия моделей</h3>
                    <div id="modelHierarchy"></div>
                </div>

                <!-- Expert Requests -->
                <div class="admin-section">
                    <h3><i class="fas fa-user-tie"></i> Запросы к эксперту</h3>
                    <button class="btn btn-secondary" onclick="showExpertRequestModal()" style="width: 100%; margin-bottom: 16px;">
                        <i class="fas fa-plus"></i> Создать запрос
                    </button>
                    <div class="expert-requests" id="expertRequests"></div>
                </div>

                <!-- System Info -->
                <div class="admin-section">
                    <h3><i class="fas fa-info-circle"></i> Системная информация</h3>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="systemUptime">0h</div>
                            <div class="stat-label">Uptime</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="systemMemory">0 MB</div>
                            <div class="stat-label">Память</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODALS ==================== -->
    <!-- Expert Request Modal -->
    <div class="modal" id="expertRequestModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Создать запрос к эксперту</h3>
                <button class="modal-close" onclick="closeModal('expertRequestModal')">×</button>
            </div>
            <div class="form-group">
                <label>Ваш вопрос</label>
                <textarea id="expertQuery" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>Контекст (необязательно)</label>
                <textarea id="expertContext" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Приоритет</label>
                <select id="expertPriority">
                    <option value="low">Низкий</option>
                    <option value="medium" selected>Средний</option>
                    <option value="high">Высокий</option>
                </select>
            </div>
            <button class="btn" onclick="submitExpertRequest()">
                <i class="fas fa-paper-plane"></i> Отправить запрос
            </button>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="loadingSpinner">
        <div class="spinner-large"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

    <script>
        // ==================== CONSTANTS ====================
        const API_BASE = 'http://localhost:8000';
        let currentTab = 'chat';
        let chatHistory = [];
        let selectedProvider = 'ollama';

        // ==================== TAB SWITCHING ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });

            // Auto-resize textarea
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Enter to send (Shift+Enter for new line)
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });

            // Initial data load
            loadInitialData();
            
            // Periodic refresh
            setInterval(() => {
                if (currentTab === 'training') {
                    loadTrainingStatus();
                }
            }, 5000);
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            currentTab = tabName;
            
            // Load tab-specific data
            loadTabData(tabName);
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'chat':
                    // Chat is always loaded
                    break;
                case 'knowledge':
                    loadRAGStats();
                    break;
                case 'training':
                    loadTrainingStatus();
                    break;
                case 'backups':
                    loadBackups();
                    break;
                case 'admin':
                    loadModelHierarchy();
                    loadExpertRequests();
                    break;
            }
        }

        async function loadInitialData() {
            try {
                await loadRAGStats();
                
        // Загрузка моделей
        async function loadModels() {
            try {
                const response = await fetch(`${API_BASE}/models`);
                if (!response.ok) return;
                const data = await response.json();
                const select = document.getElementById('modelSelect');
                if (data.models && data.models.length > 0) {
                    select.innerHTML = '';
                    data.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model.name;
                        option.textContent = model.name.replace(':latest', '');
                        select.appendChild(option);
                    });
                    const qwenOption = Array.from(select.options).find(opt => opt.value.includes('qwen2.5:7b-instruct'));
                    if (qwenOption) select.value = qwenOption.value;
                }
            } catch (error) {
                console.error('Error loading models:', error);
            }
        }
        
        loadModels();
        
        addWelcomeMessage();
            } catch (error) {
                console.error('Initial load error:', error);
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showLoading() {
            document.getElementById('loadingSpinner').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').classList.remove('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error(`API Error (${endpoint}):`, error);
                throw error;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU');
        }

        function clearCurrentTab() {
            if (confirm('Очистить данные текущей вкладки?')) {
                switch(currentTab) {
                    case 'chat':
                        document.getElementById('chatMessages').innerHTML = '';
                        chatHistory = [];
                        
        // Загрузка моделей
        async function loadModels() {
            try {
                const response = await fetch(`${API_BASE}/models`);
                if (!response.ok) return;
                const data = await response.json();
                const select = document.getElementById('modelSelect');
                if (data.models && data.models.length > 0) {
                    select.innerHTML = '';
                    data.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model.name;
                        option.textContent = model.name.replace(':latest', '');
                        select.appendChild(option);
                    });
                    const qwenOption = Array.from(select.options).find(opt => opt.value.includes('qwen2.5:7b-instruct'));
                    if (qwenOption) select.value = qwenOption.value;
                }
            } catch (error) {
                console.error('Error loading models:', error);
            }
        }
        
        loadModels();
        
        addWelcomeMessage();
                        break;
                    case 'knowledge':
                        document.getElementById('ragSearchResults').innerHTML = '';
                        break;
                    case 'training':
                        document.getElementById('trainingLogs').innerHTML = '<div class="log-entry">Журнал очищен</div>';
                        break;
                }
            }
        }

        function refreshData() {
            loadTabData(currentTab);
        }

        // ==================== CHAT FUNCTIONS ====================
        function addWelcomeMessage() {
            addMessage('assistant', `👋 Привет! Я <strong>II-Agent Pro v5.0</strong>!<br><br>
                ✨ <strong>Доступный функционал:</strong><br>
                🧠 База знаний (RAG) - вкладка "БАЗА ЗНАНИЙ"<br>
                🌙 Ночное обучение - вкладка "ОБУЧЕНИЕ"<br>
                💾 Система бэкапов - вкладка "БЭКАПЫ"<br>
                🔧 Админка и тесты - вкладка "АДМИНКА"<br><br>
                Чем могу помочь Тебе Алексей?`);
        }

        function addMessage(type, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.innerHTML = type === 'user' ? '👤' : '🤖';
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.innerHTML = type === 'assistant' ? marked.parse(content) : content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            input.style.height = 'auto';
            
            const useWeb = document.getElementById('useWeb')?.checked || false;
            const useRag = document.getElementById('useRag')?.checked || false;
            const selectedModel = document.getElementById('modelSelect')?.value || 'qwen2.5:7b-instruct-q5_K_M';
            
            try {
                const response = await fetch(`${API_BASE}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: message,
                        model: selectedModel,
                        provider: selectedProvider,
                        use_web: useWeb,
                        use_rag: useRag,
                        use_cloud: false
                    })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                
                if (data.response) {
                    addMessage('assistant', data.response);
                } else {
                    addMessage('assistant', '❌ Ошибка: пустой ответ от сервера');
                }
            } catch (error) {
                console.error('Chat error:', error);
                addMessage('assistant', '❌ Ошибка: ' + error.message);
            }
        }

        // ==================== RAG / KNOWLEDGE BASE ====================
        async function loadRAGStats() {
            try {
                const stats = await apiCall('/api/rag/stats');
                
                document.getElementById('ragDialogues').textContent = stats.dialogues || 0;
                document.getElementById('ragTraining').textContent = stats.training_items || 0;
                document.getElementById('ragSize').textContent = 
                    ((stats.db_size_mb || 0) + (stats.chroma_size_mb || 0)).toFixed(1) + ' MB';
                document.getElementById('ragUsage').textContent = stats.total_queries || 0;
            } catch (error) {
                console.error('RAG stats error:', error);
            }
        }

        async function searchRAG() {
            const query = document.getElementById('ragSearchInput').value.trim();
            const collection = document.getElementById('ragCollection').value;
            
            if (!query) {
                alert('Введите запрос для поиска');
                return;
            }

            showLoading();
            try {
                const results = await apiCall(`/api/rag/search?query=${encodeURIComponent(query)}&collection=${collection}`);
                
                const resultsDiv = document.getElementById('ragSearchResults');
                
                if (!results || results.length === 0) {
                    resultsDiv.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 20px;">Результаты не найдены</div>';
                    return;
                }

                resultsDiv.innerHTML = results.map(r => `
                    <div class="result-item">
                        <span class="result-similarity">${(r.similarity * 100).toFixed(1)}% совпадение</span>
                        <div class="result-text">${r.text.substring(0, 300)}...</div>
                        <div class="result-meta">
                            Коллекция: ${r.collection} | 
                            ${r.metadata ? `Источник: ${r.metadata.source || 'неизвестно'}` : ''}
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                alert('Ошибка поиска: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function addManualDialogue() {
            const question = document.getElementById('manualQuestion').value.trim();
            const answer = document.getElementById('manualAnswer').value.trim();
            
            if (!question || !answer) {
                alert('Заполните оба поля');
                return;
            }

            showLoading();
            try {
                await apiCall('/api/rag/add_dialogue', {
                    method: 'POST',
                    body: JSON.stringify({
                        user_message: question,
                        assistant_message: answer,
                        model_used: 'manual',
                        success_rating: 1.0
                    })
                });

                alert('✅ Диалог добавлен в базу знаний!');
                document.getElementById('manualQuestion').value = '';
                document.getElementById('manualAnswer').value = '';
                loadRAGStats();

            } catch (error) {
                alert('Ошибка добавления: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // ==================== TRAINING ====================
        async function loadTrainingStatus() {
            try {
                const status = await apiCall('/api/training/status');
                
                document.getElementById('trainingStatus').textContent = status.active ? '🔄' : '⏸️';
                document.getElementById('trainingProgress').textContent = 
                    `${status.cycles_completed || 0}/${status.cycles_total || 0}`;
                document.getElementById('trainingAdded').textContent = status.items_added || 0;
                document.getElementById('trainingCurrent').textContent = 
                    status.current_cycle || '-';

                const progress = status.cycles_total > 0 
                    ? (status.cycles_completed / status.cycles_total * 100).toFixed(0)
                    : 0;
                
                const progressBar = document.getElementById('trainingProgressBar');
                progressBar.style.width = progress + '%';
                progressBar.textContent = progress + '%';

            } catch (error) {
                console.error('Training status error:', error);
            }
        }

        async function startTraining() {
            const hours = document.getElementById('trainingHours').value;
            const cyclesPerHour = document.getElementById('trainingCyclesPerHour').value;

            if (confirm(`Запустить обучение на ${hours} часов?`)) {
                showLoading();
                try {
                    await apiCall('/api/training/start', {
                        method: 'POST',
                        body: JSON.stringify({
                            hours: parseInt(hours),
                            cycles_per_hour: parseInt(cyclesPerHour)
                        })
                    });

                    alert('✅ Обучение запущено!');
                    loadTrainingStatus();

                } catch (error) {
                    alert('Ошибка запуска: ' + error.message);
                } finally {
                    hideLoading();
                }
            }
        }

        async function stopTraining() {
            if (confirm('Остановить обучение?')) {
                showLoading();
                try {
                    await apiCall('/api/training/stop', {
                        method: 'POST'
                    });

                    alert('✅ Обучение остановлено!');
                    loadTrainingStatus();

                } catch (error) {
                    alert('Ошибка остановки: ' + error.message);
                } finally {
                    hideLoading();
                }
            }
        }

        function addCustomTopic() {
            const topic = document.getElementById('customTopic').value.trim();
            if (!topic) return;

            const listDiv = document.getElementById('customTopicList');
            const tag = document.createElement('div');
            tag.className = 'topic-tag';
            tag.innerHTML = `
                <span>${topic}</span>
                <span class="remove" onclick="this.parentElement.remove()">×</span>
            `;
            listDiv.appendChild(tag);

            document.getElementById('customTopic').value = '';
        }
        // ==================== BACKUPS ====================
        async function loadBackups() {
            showLoading();
            try {
                const backups = await apiCall('/api/backup/list');
                const listDiv = document.getElementById('backupList');

                if (!backups || backups.length === 0) {
                    listDiv.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 40px;">Бэкапы не найдены</div>';
                    return;
                }

                listDiv.innerHTML = backups.map(b => `
                    <div class="backup-item">
                        <div class="backup-info">
                            <div class="backup-hash">${b.commit_hash}</div>
                            <div class="backup-message">${b.message || 'Без комментария'}</div>
                            <div class="backup-meta">
                                <span>📅 ${formatDate(b.date)}</span>
                                <span>📁 ${b.files_changed || 0} файлов</span>
                            </div>
                        </div>
                        <div class="backup-actions">
                            <button class="icon-btn" onclick="restoreBackup('${b.commit_hash}')" title="Восстановить">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteBackup('${b.commit_hash}')" title="Удалить">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                alert('Ошибка загрузки бэкапов: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function createBackup() {
            const message = document.getElementById('backupMessage').value.trim();

            showLoading();
            try {
                await apiCall('/api/backup/create', {
                    method: 'POST',
                    body: JSON.stringify({
                        message: message || 'Manual backup from UI'
                    })
                });

                alert('✅ Бэкап создан успешно!');
                document.getElementById('backupMessage').value = '';
                loadBackups();

            } catch (error) {
                alert('Ошибка создания бэкапа: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function restoreBackup(commitHash) {
            if (!confirm(`Восстановить систему из бэкапа ${commitHash}?\n\nВСЕ ТЕКУЩИЕ ДАННЫЕ БУДУТ ЗАМЕНЕНЫ!`)) {
                return;
            }

            showLoading();
            try {
                await apiCall('/api/backup/restore', {
                    method: 'POST',
                    body: JSON.stringify({
                        commit_hash: commitHash
                    })
                });

                alert('✅ Бэкап восстановлен! Перезагрузка страницы...');
                setTimeout(() => location.reload(), 2000);

            } catch (error) {
                alert('Ошибка восстановления: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function deleteBackup(commitHash) {
            if (!confirm(`Удалить бэкап ${commitHash}?`)) {
                return;
            }

            // Note: Backend endpoint needs to be implemented
            alert('Функция удаления бэкапа будет добавлена в следующей версии');
        }

        // ==================== ADMIN - MODEL HIERARCHY ====================
        async function loadModelHierarchy() {
            try {
                const stats = await apiCall('/api/model/stats');
                const hierarchyDiv = document.getElementById('modelHierarchy');

                const tiers = [
                    { key: 'junior', name: 'Junior', icon: '🌱' },
                    { key: 'middle', name: 'Middle', icon: '⚡' },
                    { key: 'senior', name: 'Senior', icon: '🔥' },
                    { key: 'expert', name: 'Expert', icon: '👑' }
                ];

                hierarchyDiv.innerHTML = tiers.map(tier => {
                    const data = stats[tier.key] || {};
                    return `
                        <div class="model-tier ${tier.key}">
                            <div class="model-tier-header">
                                <span class="model-name">${tier.icon} ${data.model || 'N/A'}</span>
                                <span class="model-badge">${tier.name}</span>
                            </div>
                            <div class="model-stats">
                                <div class="model-stat-item">
                                    <span class="model-stat-value">${data.requests || 0}</span>
                                    <span class="model-stat-label">Запросы</span>
                                </div>
                                <div class="model-stat-item">
                                    <span class="model-stat-value">${(data.avg_response_time || 0).toFixed(1)}s</span>
                                    <span class="model-stat-label">Время</span>
                                </div>
                                <div class="model-stat-item">
                                    <span class="model-stat-value">${((data.success_rate || 0) * 100).toFixed(0)}%</span>
                                    <span class="model-stat-label">Успех</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Model hierarchy error:', error);
            }
        }

        // ==================== ADMIN - TESTS ====================
        async function runTests() {
            showLoading();
            try {
                const results = await apiCall('/api/test/run', {
                    method: 'POST',
                    body: JSON.stringify({
                        test_suite: 'all'
                    })
                });

                const resultsDiv = document.getElementById('testResults');
                
                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px;">
                        <strong>Пройдено:</strong> ${results.passed} / ${results.total_tests}<br>
                        <strong>Провалено:</strong> ${results.failed}<br>
                        <strong>Время:</strong> ${results.duration_seconds}s
                    </div>
                `;

                if (results.failures && results.failures.length > 0) {
                    resultsDiv.innerHTML += results.failures.map(f => `
                        <div class="test-result failed">
                            <div class="test-name">❌ ${f.test}</div>
                            <div class="test-error">${f.error}</div>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML += '<div class="test-result"><div class="test-name">✅ Все тесты пройдены!</div></div>';
                }

            } catch (error) {
                alert('Ошибка запуска тестов: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // ==================== ADMIN - EXPERT REQUESTS ====================
        async function loadExpertRequests() {
            try {
                const requests = await apiCall('/api/expert/requests?status=all');
                const requestsDiv = document.getElementById('expertRequests');

                if (!requests || requests.length === 0) {
                    requestsDiv.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 20px;">Запросов нет</div>';
                    return;
                }

                requestsDiv.innerHTML = requests.map(r => `
                    <div class="expert-request-item ${r.status === 'answered' ? 'answered' : ''}">
                        <div class="request-header">
                            <span class="request-id">#${r.id}</span>
                            <span class="request-priority ${r.priority}">${r.priority}</span>
                        </div>
                        <div class="request-query">${r.query}</div>
                        <div class="request-date">📅 ${formatDate(r.created_at)} | Статус: ${r.status === 'answered' ? '✅ Отвечен' : '⏳ Ожидает'}</div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Expert requests error:', error);
            }
        }

        function showExpertRequestModal() {
            showModal('expertRequestModal');
        }

        async function submitExpertRequest() {
            const query = document.getElementById('expertQuery').value.trim();
            const context = document.getElementById('expertContext').value.trim();
            const priority = document.getElementById('expertPriority').value;

            if (!query) {
                alert('Введите вопрос');
                return;
            }

            showLoading();
            try {
                await apiCall('/api/expert/request', {
                    method: 'POST',
                    body: JSON.stringify({
                        query: query,
                        context: context,
                        priority: priority
                    })
                });

                alert('✅ Запрос отправлен эксперту!');
                closeModal('expertRequestModal');
                
                // Clear form
                document.getElementById('expertQuery').value = '';
                document.getElementById('expertContext').value = '';
                document.getElementById('expertPriority').value = 'medium';
                
                loadExpertRequests();

            } catch (error) {
                alert('Ошибка отправки запроса: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // ==================== SYSTEM INFO ====================
        setInterval(async () => {
            try {
                const stats = await apiCall('/stats');
                
                // Update system info if on admin tab
                if (currentTab === 'admin') {
                    const uptime = Math.floor((Date.now() - (stats.started_at || Date.now())) / 3600000);
                    document.getElementById('systemUptime').textContent = uptime + 'h';
                    
                    // Memory usage (if available)
                    if (stats.memory_mb) {
                        document.getElementById('systemMemory').textContent = stats.memory_mb + ' MB';
                    }
                }
            } catch (error) {
                // Silently fail
            }
        }, 30000); // Every 30 seconds
    </script>

    <!-- AI DEVELOPER TAB -->
    <div id="ai-dev-tab" class="tab-content" style="display:none;">
        <h2>🤖 AI Developer</h2>
        
        <div class="ai-dev-container">
            <div class="task-input">
                <h3>адача для AI:</h3>
                <textarea id="ai-task-input" rows="4" style="width:100%; padding:10px; border-radius:5px; border:1px solid #444; background:#1a1a1a; color:#fff;">обавь логирование в функцию analyze_task</textarea>
                <button onclick="analyzeTask()" style="margin-top:10px; padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer;">🔍 нализировать задачу</button>
            </div>
            
            <div id="ai-analysis" style="margin-top:20px; display:none;">
                <h3>📋 нализ:</h3>
                <div id="analysis-result" style="background:#1a1a1a; padding:15px; border-radius:5px; border:1px solid #444;"></div>
                <button onclick="generateSolution()" style="margin-top:10px; padding:10px 20px; background:#2196F3; color:white; border:none; border-radius:5px; cursor:pointer;">🤖 Сгенерировать решение</button>
            </div>
            
            <div id="ai-solution" style="margin-top:20px; display:none;">
                <h3>💡 редложенное решение:</h3>
                <div id="solution-explanation" style="background:#1a1a1a; padding:15px; border-radius:5px; border:1px solid #444; margin-bottom:10px;"></div>
                <pre id="solution-code" style="background:#000; padding:15px; border-radius:5px; overflow-x:auto; max-height:400px;"></pre>
                <div style="margin-top:10px;">
                    <button onclick="applySolution()" style="padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer; margin-right:10px;">✅ рименить</button>
                    <button onclick="rejectSolution()" style="padding:10px 20px; background:#f44336; color:white; border:none; border-radius:5px; cursor:pointer;">❌ тклонить</button>
                </div>
            </div>
            
            <div id="ai-backups" style="margin-top:30px;">
                <h3>📜 стория бэкапов:</h3>
                <button onclick="loadBackups()" style="padding:8px 15px; background:#555; color:white; border:none; border-radius:5px; cursor:pointer;">🔄 бновить</button>
                <div id="backups-list" style="margin-top:10px;"></div>
            </div>
        </div>
    </div>
    
    <script>
    let currentAnalysis = null;
    let currentSolution = null;
    
    async function analyzeTask() {
        const task = document.getElementById('ai-task-input').value;
        if (!task) return alert('ведите задачу');
        
        try {
            const response = await fetch('http://localhost:8000/ai-dev/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({task})
            });
            
            const data = await response.json();
            if (data.success) {
                currentAnalysis = data.analysis;
                displayAnalysis(data.analysis);
            } else {
                alert('шибка анализа: ' + data.error);
            }
        } catch (e) {
            alert('шибка: ' + e.message);
        }
    }
    
    function displayAnalysis(analysis) {
        const html = `<p><strong>Сложность:</strong> </p>
            <p><strong>айлы для изменения:</strong> </p>
            <p><strong>овые файлы:</strong> </p>
            <p><strong>лан:</strong></p>
            <ol></ol>
        `;
        document.getElementById('analysis-result').innerHTML = html;
        document.getElementById('ai-analysis').style.display = 'block';
    }
    
    async function generateSolution() {
        if (!currentAnalysis) return;
        
        const files = [...currentAnalysis.files_to_modify, ...currentAnalysis.files_to_create];
        if (files.length === 0) return alert('ет файлов для обработки');
        
        const task = document.getElementById('ai-task-input').value;
        const file_path = files[0]; // ерём первый файл
        
        try {
            const response = await fetch('http://localhost:8000/ai-dev/generate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({task, file_path, current_code: ''})
            });
            
            const data = await response.json();
            if (data.success) {
                currentSolution = {file_path, ...data.solution};
                displaySolution(currentSolution);
            } else {
                alert('шибка генерации: ' + data.error);
            }
        } catch (e) {
            alert('шибка: ' + e.message);
        }
    }
    
    function displaySolution(solution) {
        document.getElementById('solution-explanation').innerHTML = `
            <p><strong>айл:</strong> </p>
            <p><strong>бъяснение:</strong> </p>
            <p><strong>зменения:</strong> </p>
        `;
        document.getElementById('solution-code').textContent = solution.code;
        document.getElementById('ai-solution').style.display = 'block';
    }
    
    async function applySolution() {
        if (!currentSolution) return;
        
        if (!confirm('рименить изменения? удет создан бэкап.')) return;
        
        // Создать бэкап
        await fetch('http://localhost:8000/ai-dev/backup', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                files: [currentSolution.file_path],
                task: document.getElementById('ai-task-input').value
            })
        });
        
        // рименить изменения
        const response = await fetch('http://localhost:8000/ai-dev/apply', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                file_path: currentSolution.file_path,
                new_code: currentSolution.code
            })
        });
        
        const data = await response.json();
        if (data.success) {
            alert('✅ зменения применены!');
            loadBackups();
        } else {
            alert('❌ шибка: ' + data.error);
        }
    }
    
    function rejectSolution() {
        document.getElementById('ai-solution').style.display = 'none';
        currentSolution = null;
    }
    
    async function loadBackups() {
        try {
            const response = await fetch('http://localhost:8000/ai-dev/backups');
            const data = await response.json();
            
            if (data.success) {
                const html = data.backups.map(backup => 
                    <div style="background:#1a1a1a; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #444;">
                        <strong></strong> - <br>
                        <small>айлов: </small>
                        <button onclick="rollbackBackup('')" style="float:right; padding:5px 10px; background:#ff9800; color:white; border:none; border-radius:3px; cursor:pointer;">↩️ ткатить</button>
                    </div>
                ).join('');
                document.getElementById('backups-list').innerHTML = html || '<p>ет бэкапов</p>';
            }
        } catch (e) {
            console.error('Load backups error:', e);
        }
    }
    
    async function rollbackBackup(backupId) {
        if (!confirm('ткатить изменения из бэкапа ' + backupId + '?')) return;
        
        const response = await fetch('http://localhost:8000/ai-dev/rollback', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({backup_id: backupId})
        });
        
        const data = await response.json();
        if (data.success) {
            alert('✅ ткат выполнен!');
            loadBackups();
        } else {
            alert('❌ шибка: ' + data.error);
        }
    }
    
    // обавить кнопку в навигацию
    document.addEventListener('DOMContentLoaded', () => {
        const nav = document.querySelector('.tab-nav');
        if (nav) {
            const aiDevBtn = document.createElement('button');
            aiDevBtn.textContent = '🤖 AI Dev';
            aiDevBtn.className = 'tab-btn';
            aiDevBtn.onclick = () => {
                document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
                document.getElementById('ai-dev-tab').style.display = 'block';
                loadBackups();
            };
            nav.appendChild(aiDevBtn);
        }
    });
    </script>


<!-- AI DEVELOPER FULL PANEL -->
<div id="ai-dev-panel" style="
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    max-width: 900px;
    max-height: 80vh;
    background: #1e1e1e;
    border: 2px solid #667eea;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    z-index: 10001;
    overflow-y: auto;
    color: white;
">
    <h2 style="margin: 0 0 20px 0; color: #667eea;">🤖 AI Developer - втоматизация разработки</h2>
    <!-- AI Developer Status Bar -->
    <div id="ai-status-bar" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; text-align: center; transition: all 0.3s ease;"></div>
    
    <style>
    .ai-status-loading {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
        background-size: 200% 100%;
        animation: gradientMove 2s ease-in-out infinite;
        color: white;
    }
    .ai-status-success {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }
    .ai-status-error {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        color: white;
    }
    @keyframes gradientMove {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    </style>

    <!-- PROVIDER SELECTOR -->
    <div style="margin-bottom: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px;">
        <label style="display: block; margin-bottom: 10px; font-weight: bold;">ыбери AI модель:</label>
        <div style="display: flex; gap: 15px;">
            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px; background: #1a1a1a; border-radius: 5px; flex: 1;">
                <input type="radio" name="ai-provider" value="ollama" checked onchange="toggleProvider()" style="margin-right: 8px;">
                <div>
                    <div style="font-weight: bold; color: #4CAF50;">💻 Ollama (окально)</div>
                    <div style="font-size: 12px; color: #888;">Qwen 2.5 7B • ез VPN • 10-30 сек</div>
                </div>
            </label>
            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px; background: #1a1a1a; border-radius: 5px; flex: 1;">
                <input type="radio" name="ai-provider" value="groq" onchange="toggleProvider()" style="margin-right: 8px;">
                <div>
                    <div style="font-weight: bold; color: #667eea;">☁️ Groq Cloud</div>
                <div class="provider-option">
                    <input type="radio" id="gigachat" name="provider" value="gigachat">
                    <label for="gigachat">
                        <span class="provider-icon">🇷🇺</span>
                        <span class="provider-name">GigaChat (Сбер)</span>
                        <span class="provider-details">Max без VPN</span>
                    </label>
                </div>
                    <div style="font-size: 12px; color: #888;">LLaMA 3.1 70B • ужен VPN • 5-15 сек</div>
                </div>
            </label>
        </div>
    </div>

    <!-- STATUS BAR -->
    <div id="ai-status-bar" style="
        display: none;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        font-weight: bold;
        text-align: center;
    "></div>
    
    <style>
    .ai-status-loading {
        background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
        background-size: 200% auto;
        animation: statusPulse 2s linear infinite;
        color: white;
    }
    .ai-status-success {
        background: #4CAF50;
        color: white;
    }
    .ai-status-error {
        background: #f44336;
        color: white;
    }
    @keyframes statusPulse {
        0% { background-position: 0% center; }
        100% { background-position: 200% center; }
    }
    </style>

    
    <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: bold;">пиши задачу:</label>
        <textarea id="ai-task-input" placeholder="апример: обавить валидацию email в форму регистрации" style="
            width: 100%;
            height: 100px;
            padding: 12px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            resize: vertical;
        "></textarea>
    </div>
    
    <button onclick="analyzeAITask()" style="
        padding: 12px 25px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        font-weight: bold;
        margin-right: 10px;
    ">🔍 нализировать задачу</button>
    
    <button onclick="document.getElementById('ai-dev-panel').style.display='none'" style="
        padding: 12px 25px;
        background: #555;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
    ">❌ акрыть</button>
    
    <div id="ai-analysis-result" style="
        margin-top: 25px;
        padding: 20px;
        background: #2d2d2d;
        border-radius: 8px;
        display: none;
    ">
        <h3 style="color: #667eea; margin-top: 0;">📋 нализ задачи:</h3>
        <div id="ai-analysis-content"></div>
        
        <button onclick="generateAISolution()" style="
            margin-top: 15px;
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
        ">✨ Сгенерировать решение</button>
    </div>
    
    <div id="ai-solution-result" style="
        margin-top: 25px;
        padding: 20px;
        background: #2d2d2d;
        border-radius: 8px;
        display: none;
    ">
        <h3 style="color: #4CAF50; margin-top: 0;">💡 Сгенерированное решение:</h3>
        <pre id="ai-solution-content" style="
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            color: #a9dc76;
        "></pre>
        
        <button onclick="applyAISolution()" style="
            margin-top: 15px;
            margin-right: 10px;
            padding: 12px 25px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
        ">✅ рименить изменения</button>
        
        <button onclick="viewAIBackups()" style="
            padding: 12px 25px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
        ">📦 стория бэкапов</button>
    </div>
</div>

<script>

        // let currentTaskData = {}; // УДАЛЕНО: дубликат из ai-developer.js

// ункция для показа статуса
function showStatus(message, type = 'info') {
    const statusEl = document.getElementById('ai-status-bar');
    statusEl.style.display = 'block';
    statusEl.className = 'ai-status-' + type;
    statusEl.innerHTML = message;
}

async function analyzeAITask() {
    const task = document.getElementById('ai-task-input').value.trim();
    if (!task) {
        alert('❌ веди описание задачи!');
        return;
    }
    
    // оказываем статус
    showStatus('🔄 тправляю задачу в Groq AI...', 'loading');
    document.getElementById('ai-analysis-result').style.display = 'none';
    document.getElementById('ai-solution-result').style.display = 'none';
    
    try {
        showStatus('🤖 Groq LLaMA 3.1 70B анализирует задачу... (5-15 секунд)', 'loading');
        
        const response = await fetch('http://localhost:8000/ai-dev/analyze', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({task: task})
        });
        
        if (!response.ok) {
            throw new Error('Backend error: ' + response.status);
        }
        
        showStatus('✅ нализ завершён! бработка результатов...', 'success');
        
        const data = await response.json();
        currentTaskData = data.analysis;
        
        const content = `<p><strong>📁 айлы для изменения:</strong></p>
            <ul></ul>
            <p><strong>📋 лан выполнения:</strong></p>
            <ol></ol>
            
            <p><strong>⚙️ Сложность:</strong> <span style="color: #FFD700;"></span></p>
        `;
        
        document.getElementById('ai-analysis-content').innerHTML = content;
        document.getElementById('ai-analysis-result').style.display = 'block';
        showStatus('✅ отово! лан сформирован.', 'success');
        
        setTimeout(() => {
            document.getElementById('ai-status-bar').style.display = 'none';
        }, 3000);
        
    } catch (error) {
        console.error('AI Developer error:', error);
        showStatus('❌ шибка: ' + error.message + ' | роверь что backend запущен на порту 8000!', 'error');
    }
}


async function generateAISolution() {
    const task = document.getElementById('ai-task-input').value;
    
    try {
        const response = await fetch('http://localhost:8000/ai-dev/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                task: task,
                files: currentTaskData.files_to_modify || []
            })
        });
        
        const data = await response.json();
        
        document.getElementById('ai-solution-content').textContent = 
            JSON.stringify(data.solution, null, 2);
        document.getElementById('ai-solution-result').style.display = 'block';
    } catch (error) {
        alert('❌ шибка генерации: ' + error.message);
    }
}

async function applyAISolution() {
    if (!confirm('⚠️ рименить изменения? удет создан автоматический бэкап.')) return;
    
    alert('🚧 ункция в разработке. спользуй API напрямую для применения изменений.');
}

async function viewAIBackups() {
    try {
        const response = await fetch('http://localhost:8000/ai-dev/backups');
        const data = await response.json();
        
        alert('📦 экапов: ' + data.backups.length + '\n\nткрой консоль (F12) для деталей.');
        console.log('AI Developer Backups:', data.backups);
    } catch (error) {
        alert('❌ шибка получения бэкапов: ' + error.message);
    }
}
</script>
<script src="ai-developer.js?v=0.41880383011246947">
        // Provider UI update function
        function updateProviderUI() {
            const buttons = {
                'ollama': document.getElementById('btn-ollama'),
                'groq': document.getElementById('btn-groq'),
                'gigachat': document.getElementById('btn-gigachat')
            };
            const status = document.getElementById('provider-status');
            
            Object.values(buttons).forEach(btn => {
                if (btn) {
                    btn.style.background = 'var(--bg-tertiary)';
                    btn.style.color = 'var(--text-secondary)';
                    btn.style.border = '1px solid var(--border)';
                }
            });
            
            const activeBtn = buttons[selectedProvider];
            if (activeBtn) {
                activeBtn.style.background = 'var(--accent-cyan)';
                activeBtn.style.color = 'var(--bg-primary)';
                activeBtn.style.border = 'none';
            }
            
            const statusText = {
                'ollama': 'LOCAL',
                'groq': 'GROQ CLOUD',
                'gigachat': 'GIGACHAT ????'
            };
            if (status) status.textContent = statusText[selectedProvider] || selectedProvider.toUpperCase();
        }

    function toggleProvider() {
        const radios = document.getElementsByName('ai-provider');
        for (const radio of radios) {
            if (radio.checked) {
                selectedProvider = radio.value;
                console.log('Provider switched to:', selectedProvider);
                if (typeof updateProviderUI === 'function') {
                    updateProviderUI();
                }
                break;
            }
        }
    }

        
        // Initialize on load
        setTimeout(updateProviderUI, 100);

    </script>

<script>
// ===================================================
// PROVIDER MANAGEMENT - Встроено из ai-developer.js
// ===================================================
(function() {
    // Глобальная переменная для выбранного провайдера
        });
        
        // Подсвечиваем активную кнопку
        const activeBtn = buttons[provider];
        if (activeBtn) {
            const colors = {
                'ollama': '#007bff',
                'groq': '#6f42c1',
                'gigachat': '#dc3545'
            };
            activeBtn.style.background = colors[provider];
            activeBtn.style.color = 'white';
        }
    };
    
    // Инициализация при загрузке
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            window.selectProvider('ollama');
            console.log('✅ Provider management initialized');
        });
    } else {
        window.selectProvider('ollama');
        console.log('✅ Provider management initialized');
    }
})();
</script>

</body>
</html>
